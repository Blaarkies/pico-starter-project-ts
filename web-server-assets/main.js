var w=Object.getPrototypeOf,A,O,m,S,ne={isConnected:1},Oe=1e3,j,J={},De=w(ne),re=w(w),_,oe=(e,t,n,r)=>(e??(setTimeout(n,r),new Set)).add(t),ie=(e,t,n)=>{let r=m;m=t;try{return e(n)}catch{return n}finally{m=r}},$=e=>e.filter(t=>{var n;return(n=t._dom)==null?void 0:n.isConnected}),le=e=>j=oe(j,e,()=>{for(let t of j)t._bindings=$(t._bindings),t._listeners=$(t._listeners);j=_},Oe),H={get val(){var e;return(e=m==null?void 0:m._getters)==null||e.add(this),this.rawVal},get oldVal(){var e;return(e=m==null?void 0:m._getters)==null||e.add(this),this._oldVal},set val(e){var t;(t=m==null?void 0:m._setters)==null||t.add(this),e!==this.rawVal&&(this.rawVal=e,this._bindings.length+this._listeners.length?(O==null||O.add(this),A=oe(A,this,Ve)):this._oldVal=e)}},ae=e=>({__proto__:H,rawVal:e,_oldVal:e,_bindings:[],_listeners:[]}),D=(e,t)=>{let n={_getters:new Set,_setters:new Set},r={f:e},l=S;S=[];let a=ie(e,n,t);a=(a??document).nodeType?a:new Text(a);for(let s of n._getters)n._setters.has(s)||(le(s),s._bindings.push(r));for(let s of S)s._dom=a;return S=l,r._dom=a},X=(e,t=ae(),n)=>{let r={_getters:new Set,_setters:new Set},l={f:e,s:t};l._dom=n??(S==null?void 0:S.push(l))??ne,t.val=ie(e,r,t.rawVal);for(let a of r._getters)r._setters.has(a)||(le(a),a._listeners.push(l));return t},se=(e,...t)=>{for(let n of t.flat(1/0)){let r=w(n??0),l=r===H?D(()=>n.val):r===re?D(n):n;l!=_&&e.append(l)}return e},de=(e,t,...n)=>{var k;let[{is:r,...l},...a]=w(n[0]??0)===De?n:[{},...n],s=e?document.createElementNS(e,t,{is:r}):document.createElement(t,{is:r});for(let[h,p]of Object.entries(l)){let y=b=>b?Object.getOwnPropertyDescriptor(b,h)??y(w(b)):_,x=t+","+h,f=J[x]??(J[x]=((k=y(w(s)))==null?void 0:k.set)??0),c=h.startsWith("on")?(b,E)=>{let u=h.slice(2);s.removeEventListener(u,E),s.addEventListener(u,b)}:f?f.bind(s):s.setAttribute.bind(s,h),g=w(p??0);h.startsWith("on")||g===re&&(p=X(p),g=H),g===H?D(()=>(c(p.val,p._oldVal),s)):c(p)}return se(s,a)},te=e=>({get:(t,n)=>de.bind(_,e,n)}),ue=(e,t)=>t?t!==e&&e.replaceWith(t):e.remove(),Ve=()=>{let e=0,t=[...A].filter(r=>r.rawVal!==r._oldVal);do{O=new Set;for(let r of new Set(t.flatMap(l=>l._listeners=$(l._listeners))))X(r.f,r.s,r._dom),r._dom=_}while(++e<100&&(t=[...O]).length);let n=[...A].filter(r=>r.rawVal!==r._oldVal);A=_;for(let r of new Set(n.flatMap(l=>l._bindings=$(l._bindings))))ue(r._dom,D(r.f,r._dom)),r._dom=_;for(let r of n)r._oldVal=r.rawVal},i={tags:new Proxy(e=>new Proxy(de,te(e)),te()),hydrate:(e,t)=>ue(e,D(t,e)),add:se,state:ae,derive:X};var z=JSON.stringify,G={"Content-Type":"text/json; charset=utf-8"};function L(e,t){return Object.assign(e,t)}function P(e,t=0){let n=null,r=null,l;return function(...a){let s=this;n?(r=a,l=s):(e.apply(s,a),n=setTimeout(()=>{n=null,r&&(e.apply(l,r),r=null,l=null)},t))}}var C=e=>Math.round(e*10)/10;function U(e=0){return new Promise(t=>setTimeout(t,e))}var{input:Ee,div:Ie,button:We}=i.tags,pe=e=>{let{initialValue:t,onchange:n}=L({initialValue:0,onchange:()=>{}},e),r=a=>n(Number(a.target.value)),l=Ie({class:"super-led-control"});return i.add(l,We({onclick:()=>n(0)},"\u{1F6AB}")),i.add(l,Ee({type:"range",min:0,max:99,step:1,value:t,oninput:P(r,300)})),l};var Y="dark",ce="dark-mode",M;function K(){let e=localStorage.getItem(Y);if(e===null){let t=window.matchMedia("(prefers-color-scheme: dark)").matches;localStorage.setItem(Y,String(t)),M=t}else M=e==="true";M?document.body.classList.add(ce):document.body.classList.remove(ce),window.requestAnimationFrame(()=>document.body.classList.add("animate"))}function me(){return localStorage.setItem(Y,String(!M)),K(),M}function fe(){return M}var Fe=e=>e?"\u{1F319}":e===null?"\u{1F317}":"\u{1F31E}",Q=i.state(null);window.requestAnimationFrame(()=>Q.val=fe());var ge=()=>i.tags.button({class:"dark-mode-button",onclick:()=>Q.val=me()},()=>Fe(Q.val));function he(e){let t=this.ctx??(this.ctx=new OffscreenCanvas(1,1).getContext("2d"));return t.fillStyle=e,t.fillRect(0,0,1,1),"#"+Array.from(t.getImageData(0,0,1,1).data.subarray(0,3)).map(n=>n.toString(16).padStart(2,"0")).join("")}var{div:V,input:je}=i.tags,ve=e=>{let{initialColor:t,onchange:n}=L({initialColor:[0,0,0],onchange:()=>{}},e);function r(o){let[q,F]=f.val??(f.val=[o.target.offsetWidth,o.target.offsetHeight]),Te=o.offsetX/q,ee=o.offsetY/F,Le=360*Te,Me=100*Math.min(ee*2,1),Ae=100*Math.min(1-ee,1);return[Le,Me,Ae]}function l(o){return`hsl(${o[0].toFixed(1)},${o[1].toFixed(1)}%,${o[2].toFixed(1)}%)`}function a(o){let q=s(o),F=l(q);I.style.setProperty("--bg-color",F),n(he(F))}function s(o){return[o[0],o[1],o[2]*g.val]}function k(o){c.val=o,a(o)}function h(o){g.val=o*.01,a(c.val)}function p(o){E.val=o,W.style.setProperty("--bg-color",o)}function y(o){u.val=o,W.style.setProperty("--location",`${o[1]}px ${o[0]}px`)}function x(o){T.val=o,W.style.setProperty("--visible",o?"1":"0")}let f=i.state(null),c=i.state(t),g=i.state(1),b=32,E=i.state(l(t)),u=i.state([0,0]),T=i.state(!1),d=o=>{p(l(r(o))),y([C(o.offsetX)-b,C(o.offsetY)-b]),T.val||x(!0)},v=V({class:"color-picker"}),I=V({class:"preview"}),W=V({class:"magnifier"}),Z=V({class:"gradient",onpointermove:P(d,16),onpointerup:o=>{o.pointerType==="mouse"&&o.button!==0||k(r(o))},onpointerleave:()=>x(!1)}),Pe=o=>h(+o.target.value),R=o=>o.stopPropagation(),Ce=je({class:"lumo",orient:"vertical",type:"range",value:100,min:0,max:100,onpointermove:R,onpointerup:R,onpointerleave:R,oninput:P(Pe,50)});i.add(Z,W);let ke=V({class:"gradient-lumo-container"},Z,Ce);return i.add(v,I,ke),v};var B=class{constructor(t,n=0){this.max=t;this.current=n,this.previous=n}current;previous;get index(){return this.current}set(t,n){if(n!==void 0){this.previous=this.current,this.current=this.indexWrappedAround(n);return}this.previous=this.current,this.current=this.indexWrappedAround(this.current+t)}indexWrappedAround(t){let n=t%this.max;return n<0&&(n+=this.max),Math.abs(n)}wrapAroundDirection(){return Math.abs(this.current-this.previous)===1||this.current===this.previous?0:this.current<this.previous?1:-1}};var{div:N}=i.tags,$e="data-value",be=e=>{let{options:t,initialSelection:n,onchange:r}=L({options:[],initialSelection:0,onchange:()=>{}},e),l=Number.isFinite(n)?Math.floor(n):t.indexOf(n),a=new B(t.length,l),s=.5,k=new Map,h=[t.at(-1),...t,t.at(0)].map(d=>{let v=N({[$e]:d.value},d.label);return k.set(v,d),v}),p=N({class:"selector-list",tabIndex:1}),y=N({class:"camera"});setTimeout(()=>x());function x(){f=y.offsetWidth,c=C(f*s),u.style.setProperty("--item-width",`${c}px`);let d=f*.5-c*.5;u.style.setProperty("--item-offset",`${d}px`),T()}let f=window.innerWidth,c=C(f*s),g=0,u=N({class:"backboard",onpointerdown:()=>u.style.setProperty("transition","none"),onpointermove:d=>{d.pointerType==="mouse"&&d.buttons!==1||(g+=d.movementX,u.style.setProperty("--position",g+"px"))},onpointerup:()=>{u.style.setProperty("transition","");let d=C(f*s),v=Math.round((-g||-1)/d);a.set(null,v),T()}});async function T(){if(u.getAnimations().length)return;let d=c*a.index,v=a.wrapAroundDirection();if(v!==0){u.style.setProperty("transition","none");let I=v>0?-c:c*t.length;u.style.setProperty("--position",-I+"px"),await U(),u.style.setProperty("transition",""),await U()}u.style.setProperty("--position",-d+"px"),g=-d,r(t[a.index])}return p.addEventListener("keydown",d=>{d.key==="ArrowLeft"?a.set(-1):d.key==="ArrowRight"&&a.set(1),T()}),i.add(u,...h),i.add(y,u),i.add(p,y),p};var{div:ye,button:xe,hr:He}=i.tags,Be=e=>{fetch("api/set-super-led",{method:"POST",headers:G,body:z({power:e})})},we=[["fade","Fade"],["sweep-r","Sweep right"],["sweep-l","Sweep left"],["flood-out","Flood out"],["flood-in","Flood in"]].map(([e,t])=>({value:e,label:t})),Se=we[0].value,Ne=e=>fetch("api/set-new-color",{method:"POST",headers:G,body:z({animationType:Se,toRgb:e})}),_e=()=>{let e=ye({class:"app-container"});return i.add(e,ge()),i.add(e,ye({class:"main-title"},"Pico Controller")),i.add(e,xe({onclick:()=>fetch("api/power-button")},"Power")),i.add(e,xe({onclick:()=>fetch("api/cycle-brightness")},"Brightness")),i.add(e,pe({onchange:Be})),i.add(e,He({class:"separator"})),i.add(e,be({options:we,onchange:t=>Se=t.value})),i.add(e,ve({onchange:P(Ne,300)})),e};K();i.add(document.body,_e());
